# Менеджер паролей GophKeeper
![coverage](./badges/cover.svg)

## Клиент
![Alt Text](https://github.com/northmule/gophkeeper/blob/iter1/doc/client_usage.gif)

## Общие требования
GophKeeper представляет собой клиент-серверную систему, позволяющую пользователю надёжно и безопасно хранить логины, пароли, бинарные данные и прочую приватную информацию.

### Сервер должен реализовывать следующую бизнес-логику:
- регистрация, аутентификация и авторизация пользователей;
- хранение приватных данных;
- синхронизация данных между несколькими авторизованными клиентами одного владельца;
- передача приватных данных владельцу по запросу.
### Клиент должен реализовывать следующую бизнес-логику:
- аутентификация и авторизация пользователей на удалённом сервере;
- доступ к приватным данным по запросу.
### Функции, реализация которых остаётся на усмотрение исполнителя:
- создание, редактирование и удаление данных на стороне сервера или клиента;
- формат регистрации нового пользователя;
- выбор хранилища и формат хранения данных;
- обеспечение безопасности передачи и хранения данных;
- протокол взаимодействия клиента и сервера;
- механизмы аутентификации пользователя и авторизации доступа к информации.
### Дополнительные требования:
- клиент должен распространяться в виде CLI-приложения с возможностью запуска на платформах Windows, Linux и Mac OS;
- клиент должен давать пользователю возможность получить информацию о версии и дате сборки бинарного файла клиента.
### Типы хранимой информации
- пары логин/пароль;
- произвольные текстовые данные;
- произвольные бинарные данные;
- данные банковских карт.
Для любых данных должна быть возможность хранения произвольной текстовой метаинформации (принадлежность данных к веб-сайту, личности или банку, списки одноразовых кодов активации и прочее).
### Абстрактная схема взаимодействия с системой
Ниже описаны базовые сценарии взаимодействия пользователя с системой.
#### Для нового пользователя:
- Пользователь получает клиент под необходимую ему платформу.
- Пользователь проходит процедуру первичной регистрации.
- Пользователь добавляет в клиент новые данные.
- Клиент синхронизирует данные с сервером.
#### Для существующего пользователя:
- Пользователь получает клиент под необходимую ему платформу.
- Пользователь проходит процедуру аутентификации.
- Клиент синхронизирует данные с сервером.
- Пользователь запрашивает данные.
- Клиент отображает данные для пользователя.
### Необязательные функции
- поддержка данных типа OTP (one time password);
- поддержка терминального интерфейса (TUI — terminal user interface);
- использование бинарного протокола;
- наличие функциональных и/или интеграционных тестов;
- описание протокола взаимодействия клиента и сервера в формате Swagger.

## Общий принцип взаимодействия между сервером и клиентом
 - Пользователь регистрируется и затем авторизуется используя клиент для своей ОС
 - При авторизации происходит обмен публичными rsa ключами
 - Клиент передает серверу свой aes ключ зашифрованный публичным ключом сервера
 - Сервер расшифровывает aes ключ клиента своим приватным rsa ключом и сохраняет его в бд
 - Дальнейший обмен происходит в зашифрованном aes клюбчом виде, путём передачи сообщений от клиента к серверу и от сервера к клиенту

## Настройка сервера
Конфигурирование сервера начинается с файла [.server.env](.server.env)
### Параметры конфигурации
```dotenv
# Адресс и порт на котором сервер принимает подключения
ADDRESS = ":9097"
# Подключение к БД
DSN = "postgres://postgres:123@localhost:5456/gophkeeper?sslmode=disable"
# Уроверь логирования
LOG_LEVEL = "debug"
# Уровень сжатия gzip для http
HTTP_COMPRESS_LEVEL = 5
# Алгоритм хэширования пароля
PASSWORD_ALGO_HASHING = "sha512"
# Путь к папке для сохранения файлов пользователей
PATH_FILE_STORAGE = "/home/user/load_project"
# Путь для сохранения публичного и приватного ключей
PATH_KEYS = "/home/user/load_project"
# Перезаписывать ключи при старте сервера
OVERWRITE_KEYS = false
```
## Настройка и запуск клиента
Клиент работает в консольном режиме и выполнен на базе [charmbracelet/bubbletea](https://github.com/charmbracelet/bubbletea). 
Конфигурация клиента начинается с файла client.yaml. Файл конфигурации должен находится рядом с клиентом.
```yaml
# Адрес сервера
ServerAddress: "http://localhost:9097"
# Уровень логирования клиента
LogLever: "info"
# Папка для сохранения файлов с сервера
FilePath: "/tmp"
# Путь с расположением публичного и приватного ключей клиента
PathKeys: "/home/djo/Загрузки/load_project/client"
# Путь к папке с публичным ключем сервера
PathPublicKeyServer: "/home/djo/Загрузки/load_project/public_server"
# Перезаписывать клиентские ключи при старте клиента
OverwriteKeys: false
```
При запуске клиента будут сгенерированы необходимые ключи и сохранены в PathKeys

### Возможности клиента
 - Регистрация / авторизация пользователя
 - Доступ к данным только после авторизации
 - Добавление / изменение данных
 - Ввод данных банковских карт, текстовых данных, бинарных данных (отправка и получение файлов)
 - Табличный просмотр введённых данных

## Библиотеки использованные в проекте
 - Моккирования запросов к бд [github.com/DATA-DOG/go-sqlmock v1.5.2](https://github.com/DATA-DOG/go-sqlmock) 
 - Интерфейс консоли [github.com/charmbracelet/bubbles v0.20.0](https://github.com/charmbracelet/bubbles)
 - Интерфейс консоли [github.com/charmbracelet/bubbletea v1.2.4](https://github.com/charmbracelet/bubbletea)
 - Работа с типами файлов [github.com/gabriel-vasile/mimetype v1.4.7](https://github.com/gabriel-vasile/mimetype)
 - Маршрутизация HTTP [github.com/go-chi/chi/v5 v5.1.0](https://github.com/go-chi/chi)
 - Работа с JWT [github.com/go-chi/jwtauth/v5 v5.3.1](https://github.com/go-chi/jwtauth)
 - Утилита для построени запросов и разбора ответа [github.com/go-chi/render v1.0.3](https://github.com/go-chi/render)
 - Валидация полей на основе псевдокода [github.com/go-playground/validator/v10 v10.23.0](https://github.com/go-playground/validator/v10)
 - Работа с JWT [github.com/golang-jwt/jwt/v4 v4.5.1](https://github.com/golang-jwt/jwt)
 - Утилита для сравнения объектов [github.com/google/go-cmp v0.6.0](https://github.com/google/go-cmp)
 - Генерация UUID [github.com/google/uuid v1.6.0](https://github.com/google/uuid)
 - Работа с Postgres [github.com/jackc/pgx/v5 v5.7.1](https://github.com/jackc/pgx/v5)
 - Миграции [github.com/pressly/goose/v3 v3.23.0](https://github.com/pressly/goose)
 - Конфигурация из файлов [github.com/spf13/viper v1.19.0](https://github.com/spf13/viper)
 - Утилиты для тестирования приложения [github.com/stretchr/testify v1.10.0](https://github.com/stretchr/testify)
 - Логирование [go.uber.org/zap v1.27.0](https://go.uber.org/zap)

## Запуск тестов
```shell
go test ./...
```